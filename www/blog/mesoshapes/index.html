<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Who’s On First</title>
        <meta name='description' content="Who's on First is a gazetteer of places.">
        <link rel='apple-touch-icon' href='../../images/favicons/apple-touch-icon.png' sizes='180x180'>
        <link rel='icon' type='image/png' href='../../images/favicons/favicon-16x16.png' sizes='16x16'>
        <link rel='icon' type='image/png' href='../../images/favicons/favicon-32x32.png' sizes='32x32'>
        <link rel='manifest' href='../../images/favicons/manifest.json'>
        <link rel='mask-icon' href='../../images/favicons/safari-pinned-tab.svg' color='#2C1E3F'>
		
		<link rel="stylesheet" href="../../css/bootstrap.min.css">
		<link rel="stylesheet" href="../../css/mapzen.whosonfirst.css">
    </head>
	<body>
		<div class="whosonfirst-wrapper"><nav class="navbar navbar-default navbar-fixed-top whosonfirst-fixed-subpage-navbar">
	<div class="container">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="../../">Who's On First</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li class="whosonfirst-navbar-element-collapsed">
					<a href="../../allthedata/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">data</a>
				</li>
				<li class="whosonfirst-navbar-element-collapsed">
					<a href="../../docs/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">docs</a>
				</li>
				<li class="whosonfirst-navbar-element-collapsed">
					<a href="../../tools/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">tools</a>
				</li>
				<li class="whosonfirst-navbar-element-collapsed">
					<a href="../../blog/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed whosonfirst-nav-active">blog</a>
				</li>
				<li class="whosonfirst-navbar-element-collapsed">
					<a href="../../getstarted/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">get started</a>
				</li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</div><!-- /.container-fluid -->
</nav><div class="container whosonfirst-subpage-container">
	<div class="row">
		<div class="col-lg-3 col-md-3 col-sm-3 col-xs-0">
			<aside>
				<div class="whosonfirst-sidenav-container">
				</div>
			</aside>
		</div>
		<div class="col-lg-7 col-md-9 col-sm-9 col-xs-12">
			<article><div class="whosonfirst-fulltabs-container">
	<div class="whosonfirst-extrasmall-tabs-menu">
		<div class="whosonfirst-extrasmall-tabs-menu-content">
			<div class="whosonfirst-extrasmall-tabs-menu-content-header">
				<div class="whosonfirst-extrasmall-tab-selection">Blog</div>
			</div>
		</div>
	</div>
	<div class="whosonfirst-tabs-content"><div class="container" id="content">
<div class="row text-center headroom-large hidden-print">
<div class="col-xs-12">
<a class="btn btn-default btn-transparent" href="/blog">
<i class="fa fa-angle-left">
</i>
blog
</a>
</div>
</div>
<div class="row headroom-large">
<div class="col-md-8 col-md-offset-2">
<h2 class="no-margin text-center">
Improving county coverage in Who&#39;s On First
</h2>
<ul class="tag-list headroom">
<a href="/tag/whosonfirst">
<li>
whosonfirst
</li>
</a>
<a href="/tag/data">
<li>
data
</li>
</a>
</ul>
<div class="">
</div>
<div class="static-content headroom-large blog-content">
<p>
<img src="images/mesohapes-import-1-timeseries.gif" alt="One county at a time">
</p>
<p>
We’ve doubled the number of
<code>
county
</code>
features in
<a href="https://whosonfirst.mapzen.com">
Who’s On First
</a>
, a gazetteer of places all based on open data.
</p>
<p>
When we first started the gazetteer, 18,214
<code>
counties
</code>
were imported from
<a href="http://quattroshapes.com">
Quattroshapes
</a>
, a compendium of open data from national mapping agencies. We’ve grown that number to
<a href="https://whosonfirst.mapzen.com/spelunker/placetypes/county/#4/-1.97/-47.02">
41,275
</a>
counties in 2016 by adding open data from additional CC-BY sources, and by creating new shapes that Mapzen is releasing as CC0.
</p>
<p>
We’re on track to having the first high-quality, open-licensed dataset of
<code>
county
</code>
polygons that combines global coverage with a permissive license to enable developers to build commercial applications.
</p>
<h3 id="why-are-county-polygons-important-to-who&#39;s-on-first?">
Why are county polygons important to Who’s On First?
</h3>
<p>
The goal of Who’s On First has always been to build a gazetteer of places, with each place given a stable identifier and some number of descriptive properties about that location.
</p>
<p>
The goal of importing new
<code>
county
</code>
features is to upgrade shapes for existing places and  to achieve global coverage by adding additional places.
</p>
<h3 id="sourcing-additional-county-polygons">
Sourcing additional county polygons
</h3>
<p>
In many cases, new
<code>
county
</code>
data (somestimes called administrative level 2, or adm-2 for short) was imported from national mapping agencies under a CC-BY compatible license with little to no modification into Who’s On First. (Our collective advocacy for open data is paying off, thank you!)
</p>
<p>
For example, the Taiwanese government maintains openly licensed geodata for nearly all
<a href="https://github.com/whosonfirst/whosonfirst-placetypes/blob/master/README.md">
categorized placetypes
</a>
in Who’s On First. Once data for Taiwan was retrieved, property names in the source were mapped to standardized Who’s On First property names and imported using the techniques described below.
</p>
<p>
In other cases, when openly licensed
<code>
county
</code>
data could not be found for a country, Mapzen drew polygons to fill in the gaps. To draw these geometries we compared three or more reference datasets to create our own shapes. In keeping with the lineage of alphashapes, betashapes, quattroshapes, zetashapes, and yerbashapes, we call these new geometries
<strong>
mesoshapes
</strong>
, and you’ll see
<code>
meso
</code>
in the feature’s
<code>
src:geom
</code>
property.
</p>
<h3 id="mesoshapes">
Mesoshapes
</h3>
<p>
When new
<code>
county
</code>
polygons were required, Mapzen drew them using a semi-automated GIS process:
</p>
<ul>
<li>
seed a set of points across the entire country
</li>
<li>
discard points within a buffer of the reference’s boundary line geometries
</li>
<li>
for each point, compare the reference sources to determine if there is consensus about which county the point falls in
</li>
<li>
create
<a href="https://pro.arcgis.com/en/pro-app/tool-reference/analysis/create-thiessen-polygons.htm">
Thiessen polygons
</a>
around each consensus point
</li>
<li>
dissolve Thiessen polygons based on the consensus county attribute
</li>
<li>
generalize the resulting polygon shapes
</li>
</ul>
<p>
Some manual cleanup was performed, but not a lot. In our review, areas with good consensus between references on the essential facts will result in good polygons – and this is true for the majority of our results. This process allowed us to import new
<code>
county
</code>
polygons for countries that do not currently offer open data.
</p>
<h3 id="how-were-new-county-polygons-imported?">
How were new county polygons imported?
</h3>
<p>
Once new
<code>
county
</code>
features were inventoried, an import strategy was needed to handle all geometries, associated properties, and potential conflicts. As a first step, each new
<code>
county
</code>
feature was compared to all existing
<code>
county
</code>
features for the appropriate country. This was done by:
</p>
<ul>
<li>
Comparing names of the
<code>
county
</code>
feature with name properties of existing Who’s On First features.
</li>
<li>
Ensuring the
<code>
county
</code>
feature’s parent (likely a region) matched the existing Who’s On First feature’s parent. Many countries share names among several
<code>
county
</code>
features; comparing names
<em>
and
</em>
locations are equally important.
</li>
</ul>
<p>
If this resulted in no matches, the
<code>
county
</code>
feature was imported as a new feature to Who’s On First. If a match was found, the following considerations were needed:
</p>
<ul>
<li>
Adding properties from the new
<code>
county
</code>
feature properties to existing Who’s On First record
</li>
<li>
Retaining existing Who’s On First record properties
</li>
<li>
Handling all variations of names and name variants during the merge
</li>
<li>
Storing the existing feature’s outdated geometry as an alt-geometry file
</li>
<li>
Attaching the new geometry to the existing feature while updating any geometry-related property
</li>
</ul>
<p>
Additionally, since we know all new
<code>
county
</code>
features are contiguous and inclusive of all counties in a given country, we needed to deprecate any “leftover” features in Who’s On First that did not match any incoming
<code>
county
</code>
features.
</p>
<h3 id="comparing-records-pre-import-and-post-import">
Comparing records pre-import and post-import
</h3>
<p>
Let’s compare the
<code>
county
</code>
features in Afghanistan, pre-import and post-import. Before importing new
<code>
county
</code>
geometries, Who’s On First maintained records for 25 counties in Afghanistan, all of which were represented by point geometries. There were 400 new
<code>
county
</code>
polygon features created for Afghanistan; each of these features were compared to the 25 existing county records in Afghanistan.
</p>
<p>
Below, the county records prior to importing counties are shown as yellow points. The new
<code>
county
</code>
polygons are displayed as polygons (blue outline). Zoom in to see all new county names, or
<a href="https://tangrams.github.io/tangram-frame/?minz=5&amp;maxz=10&amp;url=https://s3.amazonaws.com/whosonfirst.mapzen.com/misc/_blogs/mesoshapes_blogpost.yaml&amp;maxbounds=29.377217,60.475769,38.490733,74.889862#5.5/34.179/65.126">
view full screen
</a>
.
</p>
<div class="demo-wrapper" style="height: 60vh; width: 80vw; margin-left: calc(50% - 40vw);">
<iframe src="https://tangrams.github.io/tangram-frame/?noscroll&amp;minz=5&amp;maxz=10&amp;maxbounds=29.377217,60.475769,38.490733,74.889862&amp;url=https://s3.amazonaws.com/whosonfirst.mapzen.com/misc/_blogs/mesoshapes_blogpost.yaml#5.5/34.179/65.126">
Your browser doesn&amp;amp;rsquo;t support iframe, &amp;lt;a href=&amp;#34;https://tangrams.github.io/tangram-frame/?minz=5&amp;amp;maxz=10&amp;amp;url=https://s3.amazonaws.com/whosonfirst.mapzen.com/misc/_blogs/mesoshapes_blogpost.yaml&amp;amp;maxbounds=29.377217,60.475769,38.490733,74.889862#5.5/34.179/65.126&amp;#34; target=&amp;#34;_blank&amp;#34;&amp;gt;click here to see demo&amp;lt;/a&amp;gt;
</iframe>
</div>
<p>
Prior to the import of new
<code>
county
</code>
features, Who’s On First had a total of
<strong>
8,172
</strong>
mostly point geometry based county features for the countries included in the first round of countries (added earlier in 2016 and not included in the animated map).
</p>
<p>
After the import, Who’s On First contains
<strong>
21,469
</strong>
<code>
county
</code>
features for those same countries - an increase of
<strong>
13,297
</strong>
<code>
county
</code>
features.
<strong>
Forty
</strong>
of these countries had virtually no county coverage in Who’s On First, but now have high-quality
<code>
county
</code>
records available for use or download.
</p>
<p>
In rare cases (including Chile, Indonesia, New Zealand, South Africa, and the Ukraine), the earlier 2015 data was found to be poor-quality and was upgraded with high-quality data.
</p>
<p>
<img src="images/mesohapes-import-1-2016.gif" alt="Mesoshapes in 2016">
</p>
<h3 id="next-steps...">
Next steps…
</h3>
<p>
While Who’s On First has already imported a substantial number of new
<code>
county
</code>
features, we plan on importing additional
<code>
county
</code>
features through early 2017. So far we’ve processed an additional 3,353 features over today’s announcement (show in black outlines on the map below). That leaves Canada and a handful of countries in Africa and Asia (ignoring small island countries for now). In our research we’ve found many European countries skip the
<code>
county
</code>
administrative level and go straight to
<code>
localadmin
</code>
, but please send us data sources, tips, and corrections!
</p>
<p>
<img src="images/mesohapes-import-1-in-progress.gif" alt="Mesoshapes in progress">
</p>
<p>
We found a few other data gems along the way, so expect related improvements to other placetypes including
<code>
locality
</code>
and
<code>
region
</code>
.
</p>
<p>
Most new
<code>
county
</code>
feature includes a unique Statoids
<a href="http://www.statoids.com/ihasc.html">
HASC code
</a>
in their properties. Besides joining the HASC code with demographic tables to create data visualizations, you could use the code to dissolve
<code>
county
</code>
geometries into new
<code>
region
</code>
polygons that are often better quality than the existing region polygon in Who’s On First. The following HASC codes, as an example, would be used to create the
<code>
AF.AR
</code>
region shape (with a little help from QGIS).
</p>
<div class="highlight">
<pre>
<code class="language-text" data-lang="text">
AF.AR.EC
AF.AR.PL
AF.AR.FG
AF.AR.RT
</code>
</pre>
</div>
<p>
And there you have it - new county polygons in Who’s On First! Thanks for reading and stay tuned for the next rounds of new administrative polygons!
</p>
<p>
<em>
Please
<a href="mailto:hello@mapzen.com">
let us know what you think
</a>
!
</em>
</p>
</div>
<div class="headroom-large footroom-large text-center hidden-print">
<div class="social-buttons hidden-print">
<ul>
<li class="social-button social-button-twitter">
<a href="http://twitter.com/home?status=Improving county coverage in Who&#39;s On First%20@mapzen%20https://mapzen.com/blog/mesoshapes" class="social-popup" title="Twitter">
<span class="icon">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" space="preserve">
<path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
            c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
            C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
            C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
            c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
            C26.275,7.229,25.39,8.196,24.253,8.756z">
</path>
</svg>
</span>
<span class="sr-only">
twitter
</span>
</a>
</li>
<li class="social-button social-button-facebook">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://mapzen.com/blog/mesoshapes" class="social-popup" title="Facebook">
<span class="icon">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" space="preserve">
<path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
              c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
              c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z">
</path>
</svg>
</span>
<span class="sr-only">
facebook
</span>
</a>
</li>
<li class="social-button social-button-pinterest">
<a href="http://pinterest.com/pin/create/button/?url=https://mapzen.com/blog/mesoshapes&amp;media=images/mesohapes-import-1-2015-2016.gif&amp;description=Improving county coverage in Who&#39;s On First" class="social-popup" title="Pinterest">
<span class="icon">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" space="preserve">
<path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785
            C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458
            c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557
            c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168
            C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239
            c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z">
</path>
</svg>
</span>
<span class="sr-only">
pinterest
</span>
</a>
</li>
<li class="social-button social-button-email">
<a href="mailto:?subject=Improving county coverage in Who&#39;s On First&amp;body=https://mapzen.com/blog/mesoshapes" class="social-popup" title="E-mail">
<span class="icon">
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" space="preserve">
<g>
<path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z">
</path>
</g>
</svg>
</span>
<span class="sr-only">
email
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="post-meta headroom text-center">
<div class="byline">
<span class="byline-date no-top-margin">
08 December 2016
</span>
</div>
<ul class="author-blurbs clearfix">
<li class="author-blurb author-blurb-half-width">
<div class="author-blurb-portrait">
<a href="https://twitter.com/stepps00" class="no-print-link">
<img class="avatar" src=" https://s.gravatar.com/avatar/3098a927ec8789692ad53b15530aee78?s=80 ">
</a>
</div>
<div class="author-blurb-text">
<span class="byline-author">
<a href="https://twitter.com/stepps00" class="no-print-link">
Stephen Epps
</a>
</span>
<p>
Stephen is Mapzen&#39;s gardener and fixer-upper of geographic data.
</p>
</div>
</li>
<li class="author-blurb author-blurb-half-width">
<div class="author-blurb-portrait">
<a href="https://twitter.com/kelsoscorner" class="no-print-link">
<img class="avatar" src=" https://www.gravatar.com/userimage/3501320/c1d5ee2eb950f87d2febe309ea5a1ce5.png ">
</a>
</div>
<div class="author-blurb-text">
<span class="byline-author">
<a href="https://twitter.com/kelsoscorner" class="no-print-link">
Nathaniel Vaughn Kelso
</a>
</span>
<p>
Map geek, cartographer, and data omnivore. Nathaniel leads the data team at Mapzen and vacations @nullisland.
</p>
</div>
</li>
<li class="author-blurb author-blurb-half-width">
<div class="author-blurb-portrait">
<a href="https://twitter.com/themappist" class="no-print-link">
<img class="avatar" src=" https://pbs.twimg.com/profile_images/584895811500269569/Pmzr3KAz.jpg ">
</a>
</div>
<div class="author-blurb-text">
<span class="byline-author">
<a href="https://twitter.com/themappist" class="no-print-link">
Martin Gamache
</a>
</span>
<p>
Martin Gamache is a cartographer and geographer with Art of the Mappable.
</p>
</div>
</li>
</ul>
</div>
<div class="pagination headroom hidden-print">
<a class="pagination-link pagination-previous" href="/blog/structured-geocoding">
<i class="fa fa-fw fa-angle-left">
</i>
<span class="pagination-link-text">
Do Less, Get More!
</span>
</a>
<a class="pagination-link pagination-next" href="/blog/tangram-interactivity">
<i class="fa fa-fw fa-angle-right">
</i>
<span class="pagination-link-text">
Interactive Mapping with Tangram
</span>
</a>
</div>
</div>
</div>
</div>
								</div>
							</div>
						</article>
					</div>
					<div class="col-lg-2 col-md-0 col-sm-0 col-xs-0"></div>
				</div>
			</div>
		</div>
		<footer>
			<nav class="navbar navbar-default navbar-bottom">
				<div class="container">
					<!-- Collect the nav links, forms, and other content for toggling -->
					<ul class="nav navbar-nav navbar-right whosonfirst-footer">
						<li class="whosonfirst-nav-link-nounderline whoosonfooter-gig">who's on first is a <a href="https://mapzen.com/" class="whosonfirst-nav-link whosonfirst-nav-link-innounderline">mapzen</a> gig</li>
						<li><a href="../../docs/contributing/" class="whosonfirst-nav-link whosonfirst-footer-nav-link">contributing</a></li>
						<li><a href="../../docs/licensing/" class="whosonfirst-nav-link whosonfirst-footer-nav-link">licensing</a></li>
						<li><a href="https://github.com/whosonfirst" class="whosonfirst-nav-link whosonfirst-footer-nav-link">code github</a></li>
						<li><a href="https://github.com/whosonfirst-data" class="whosonfirst-nav-link whosonfirst-footer-nav-link">data github</a></li>
						<li><a href="https://twitter.com/alloftheplaces/" class="whosonfirst-nav-link whosonfirst-footer-nav-link">twitter</a></li>
					</ul>
				</div>
			</nav>
		</footer>
		
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="../../javascript/jquery.min.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="../../javascript/bootstrap.min.js"></script>
		<script src="../../javascript/mapzen.whosonfirst.subpage.js"></script>
	</body>
</html>
